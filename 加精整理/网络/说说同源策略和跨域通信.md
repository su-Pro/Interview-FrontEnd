## åŒæºç­–ç•¥

### æ ¸å¿ƒ
**æ¦‚å¿µ**ï¼š åŒæºç­–ç•¥é™åˆ¶ä»Žä¸€ä¸ªæºæ–‡ä»¶æˆ–è„šæœ¬å¦‚ä½•ä¸Žå¦ä¸€ä¸ªæºçš„èµ„æºè¿›è¡Œäº¤äº’ï¼Œæ˜¯ä¸€ä¸ªç”¨äºŽéš”ç¦»æ½œåœ¨æ¶æ„æ–‡ä»¶çš„å®‰å…¨æœºåˆ¶ã€‚
**æºçš„æ¦‚å¿µ**ï¼š åè®®åã€åŸŸåã€ç«¯å£ã€‚
**é™åˆ¶**ï¼š ä¸æ˜¯åŒä¸€ä¸ªæºï¼Œæ²¡æœ‰æƒé™æ“ä½œå¦ä¸€ä¸ªæºçš„æ–‡æ¡£ã€‚
- Cookieï¼ŒlocalStoragã€indexDBæ— æ³•èŽ·å–
- æ— æ³•èŽ·å–æ“ä½œDOM
- AJAXè¯·æ±‚æ— æ³•æˆåŠŸå‘é€

### å‰åŽç«¯é€šä¿¡
1. **Ajax** --> Ajaxåªé€‚åˆåŒæºé€šä¿¡
2. **WebScoket** --> ä¸å—åŒæºç­–ç•¥é™åˆ¶
3. **CORS** --> æ˜¯æ–°çš„é€šä¿¡æ ‡å‡†,æ”¯æŒåŒæºé€šä¿¡ä¹Ÿæ”¯æŒè·¨åŸŸé€šä¿¡ã€‚

### å¦‚ä½•åˆ›å»ºajax
1. XMLHttpRequestå¯¹è±¡å·¥ä½œåŽŸç†
2. å…¼å®¹æ€§å¤„ç†
3. äº‹ä»¶çš„è§¦å‘æ¡ä»¶
4. æ—¶é—´çš„è§¦å‘é¡ºåº

``` JS
//å…³é”®ä»£ç ï¼š
// 1. ç¬¬ä¸€æ­¥ï¼Œç”³æ˜Žxhrå¯¹è±¡ï¼Œè€ƒè™‘ieçš„å…¼å®¹æ€§ã€‚
var xhr = XMLHttpRequest ? new XMLHttpRequest() : new window.ActiveObject('Microsoft.XMLHTTP');
// 2. ç¡®å®šè¯·æ±‚çš„æ–¹å¼ï¼Œget/postç­‰, getå‚æ•°æ‹¼æŽ¥åœ¨urlä¸­ã€‚
xhr.open(method, url, true)
// 3. å‘é€æ•°æ®
xhr.send() / xhr.send(data)
// åˆ¤æ–­httpçš„çŠ¶æ€
xhr.onload = function () {
  // åˆ¤æ–­xhr.status
  if (xhr.status === 200 || xhr.status === 304 || xhr.status === 206) {
    // 304,æœåŠ¡å™¨åˆ¤æ–­æœ¬åœ°æœ‰ç¼“å­˜
    // 206ï¼Œè¯·æ±‚åª’ä½“èµ„æºå¯èƒ½è¿”å›žèµ„æºçš„ä¸€éƒ¨åˆ†
  } else { }
}
```

## è·¨åŸŸé€šä¿¡äº”ç§æ–¹æ³•
1. **JSONP**
``` JS
// åŽŸç†ï¼šåˆ©ç”¨scriptæ ‡ç­¾çš„å¼‚æ­¥åŠ è½½æ¥å®žçŽ°ã€‚å°±åƒåœ¨headå¤´ä¸­åŠ è½½scriptæ ‡ç­¾ä¸€æ ·ã€‚
// jsonp,å’ŒåŽå°çº¦å®šçš„å›žè°ƒå‡½æ•°å
var jsonp = function () {
  // åˆ›å»ºscriptæ ‡ç­¾
  var script = document.createElement('script');
  // ç»™scriptæ·»åŠ å±žæ€§ï¼Œå¦‚srcï¼Œåœ¨srcä¸­çº¦å®šcallbackå‡½æ•°ã€‚
  script.src = 'http:/www.test.com/?name=zhangsan&callback=jsonp'
  // scriptåŠ è½½å®Œçš„å›žè°ƒ
  script.onload = function () { }
  // scriptåŠ è½½å¤±è´¥çš„å›žè°ƒ
  script.onerror = function () { }
  // å°†scriptæ·»åŠ åˆ°headæ ‡ç­¾ä¸­
  document.getElementsByTagName('head')[0].appendChild(script);
}
```

2. **Hash**
``` JS
// hash
// åŽŸç†ï¼šHashæ”¹å˜é¡µé¢ä¸ä¼šåˆ·æ–°ï¼Œsearchçš„æ”¹å˜ä¼šåˆ·æ–°é¡µé¢
// åœ¨Aä¸­ï¼Œä»£ç å¦‚ä¸‹
var objB = document.getElementsByTagName('iframe')[0];
objB.src = objB.src + '#' + 'data';
// åœ¨Bä¸­ï¼Œç›‘å¬hashçš„å˜åŒ–
window.onhashchange = function () {
  var data = window.location.hash  // æ‹¿åˆ°æ˜¯#åŽé¢æ‰€æœ‰çš„å†…å®¹
};
```

3. **postMessage**
``` JS
// postMessage
// å¦‚Aæºå‘Bæºå‘é€æ•°æ®data
// A, å‚æ•°å«ä¹‰ï¼šå‘é€çš„æ•°æ®ï¼ŒæŽ¥å—æ–¹çš„æºæˆ–è€…"*"
window.postMessage('data', 'http/B.com');
// B: ç›‘å¬messageï¼Œåˆ¤æ–­æ¶ˆæ¯æ¥æºï¼ŒæŽ¥å—æ•°æ®
window.addEventListerr('message', function (event) {
  console.log(event);
  // event.origin // æ¶ˆæ¯æ¥æºï¼Œ'http/A.com'
  // event.source // Açš„å¼•ç”¨window
  // event.data  // æŽ¥å—çš„æ•°æ®
}, false)
```

4. **WebSocket**
``` JS
// WebSocket
// 1.å£°æ˜Ž
var WebSocket = new WebSocket('wss://......'); // wss/ws => åŠ å¯†/ä¸åŠ å¯†
// 2.å»ºç«‹é“¾æŽ¥
WebSocket = function (e) {
  console.log('å¼€å§‹è¿žæŽ¥...');
  WebSocket.send('hello WebSocket');
}
// 3.æŽ¥å—æ¶ˆæ¯
WebSocket.onmessage = function (e) {
  console.log('æŽ¥å—æ•°æ®' + e.data);
  WebSocket.CLOSED();
}
// 4.å…³é—­è¿žæŽ¥çš„å›žè°ƒï¼Œç¡®å®šå·²å…³é—­è¿žæŽ¥
WebSocket.onclose = function (e) {
  console.log('è¿žæŽ¥å…³é—­');
}
```

5. **fetch**
``` JS
// å¯ä»¥ç®€å•çš„ç†è§£ä¸ºæ”¯æŒè·¨åŸŸé€šä¿¡çš„Ajax
// åŽŸç†ï¼šæµè§ˆå™¨ä¼šæ‹¦æˆªajaxè¯·æ±‚ï¼Œå¦‚æžœå‘çŽ°æ˜¯è·¨åŸŸè¯·æ±‚ï¼Œåˆ™ä¼šåœ¨è¯·æ±‚å¤´ä¸­åŠ ä¸€ä¸ªorigin
// éœ€è¦ç”¨åˆ°es6çš„fetch API
fetch('/api/uri', {
  // åœ¨è¿™é‡Œé…ç½®è·¨åŸŸå‚æ•°
  method: 'get',
  params: {}
}).then(res => {
  // æˆåŠŸçš„å›žè°ƒ
}).catch(error => {
  // å¤±è´¥çš„å›žè°ƒ
})
```

[ðŸš—æ–‡ç« å­¦ä¹ åœ°ç‚¹æŽ˜é‡‘](https://juejin.im/post/6844903860499136520)