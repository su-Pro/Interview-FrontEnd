## 缓存代理
### 核心
在客户端与服务器直接通信中间添加了一个代理服务器，代理服务器用来给客户端服务。

### 流程
1. **浏览器**拿到网址，判断是否可以缓存。
2. **浏览器**拿到host来查看缓存，通过DNS解析，最终通过**负载均衡**或**轮询**来返回IP地址。
3. **浏览器**查看缓存并添加头部字段,并且建立与代理服务器TCP的连接。第一次建立，需要TCP三次握手。
4. **代理服务器**拿到请求，查看缓存有则返回（返回之前通过头部字段进行对资源是否过期可用判断），无则拿着客户端的请求去向服务端请求。
5. **真实服务器**收到请求，通过头字段判断资源是否有更新，无更新返回304。有更新打包返回，并且添加头字段（给代理服务器一些限制），并根据需求返回301或者302.
6. **代理服务器**收到请求，通过判断private不进行缓存，public根据头字段来进行缓存资源并优化，返回给客户端。
7. **客户端**接收到，304直接渲染，301或者302重新发起**URL请求。**
8. 最后TCP四次挥手，断开连接。

### 关于头字段
头字段介绍
| 代理服务器 | 作用 | 真实服务器 | 作用 |
| ---- | ---- | ---- | ---- | 
| no-store | 是否缓存 | must-revalidate | 缓存不过期，可用过期，必须重新请求验证 | 
| no-cache | 缓存必须进程验证 | proxy-revalidate | 缓存过期只要求代理进行请求验证 |
| only-if-cached | 只接受代理缓存 | no-transform | 不允许代理给缓存做任何改变 |
| max-age | 最大生存时间 | private | 不能在代理层保存，只能在客户端保存 | 
| max-stale | 短时期可用 | public | 缓存完全开放 |
| min-fresh | 判断是否过期 | s-maxage | 缓存在代理商可用缓存的时间 |
| if-Modifed-Since和if-None-Match和Last-Modifed/Etag | 判断是否有更新 | xxx | xxx |

### 补充
[埋坑： 🚀🚀🚀简述下CDN]()